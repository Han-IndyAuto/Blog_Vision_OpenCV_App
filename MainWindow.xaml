<Window x:Class="Vision_OpenCV_App.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:Vision_OpenCV_App"
        mc:Ignorable="d"
        Title="MainWindow" Height="768" Width="1280"
        Closing="Window_Closing"
        >

    <!--x:Class="IndyVision.MainWindow" :
    "이 디자인 파일(XAML)의 **영혼(C# 코드)**은 IndyVision 이름 공간에 있는 MainWindow 클래스야! 
    역할: **디자인(XAML)**과 **로직(C# 코드, MainWindow.xaml.cs)**을 하나로 묶어주는 연결 고리입니다.
    -->

    <!--xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation" :
    xmlns는 XML NameSpace의 약자입니다. (C#의 using과 비슷합니다.)
    의미: "앞에 아무 별명(접두어)이 안 붙은 태그들(<Grid>, <Button>, <Image> 등)은 모두 WPF 표준 보따리에서 꺼내온 거야."
    역할: WPF의 기본 컨트롤들을 편하게 쓰기 위한 기본 설정입니다. 
    이 주소는 실제 웹사이트가 아니라, MS가 정해놓은 고유 식별자(ID)입니다.
    -->

    <!--xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" :
    의미: "앞에 x: 가 붙은 애들은 XAML 언어 자체의 규칙에 관련된 거야."
    역할: XAML 문법을 위한 도구 상자입니다.
    예: x:Name (이 컨트롤의 변수 이름 짓기), x:Key (리소스 사전에서 찾을 이름), x:Class (클래스 연결)
    -->

    <!--xmlns:d="http://schemas.microsoft.com/expression/blend/2008":
    의미: "앞에 d: 가 붙은 애들은 디자인(Design) 모드에서만 쓰는 가짜 데이터야." 
    역할: 비주얼 스튜디오의 **미리보기 화면(Designer)**을 위한 도구입니다.  
    예: d:DataContext, d:DesignWidth. 프로그램을 실제로 실행했을 때는 무시되고, 
    개발자가 화면을 디자인할 때만 참고용으로 쓰입니다.
    -->

    <!--xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006 :
    의미: "Markup Compatibility(마크업 호환성) 도구 상자야."
    역할: XAML 파일이 실행될 때, 특정 속성들을 무시하거나 호환성을 맞추기 위해 사용합니다. 
    주로 바로 아래 설명할 mc:Ignorable과 짝꿍으로 다닙니다.
    -->

    <!--xmlns:sys="clr-namespace:System;assembly=mscorlib" :
    의미: "앞에 sys: 가 붙으면 C#의 기본 시스템 타입(System)을 가져다 쓰는 거야."
    역할: XAML 안에서 String, Int32, Double 같은 C# 기본 변수 타입을 쓰고 싶을 때 사용합니다.
    예: 콤보박스 아이템으로 단순 문자열을 넣을 때 <sys:String>옵션1</sys:String> 처럼 씁니다.
    -->

    <!--xmlns:local="clr-namespace:IndyVision" : 
    의미: "앞에 local: 이 붙으면 내 프로젝트(IndyVision) 안에 있는 클래스를 가져다 쓰는 거야."
    역할: 내가 만든 클래스를 XAML에서 사용할 때 씁니다.
    예: <local:MainViewModel/> (내가 만든 뷰모델 사용), <local:ThresholdParams/> (내가 만든 파라미터 클래스 사용).
    보통 프로젝트 이름이 IndyVision이라서, 현재 프로젝트를 가리킨다는 의미로 local이라는 별명을 붙입니다.
    -->

    <!--mc:Ignorable="d" :
    의미: "프로그램을 빌드해서 실행할 때(Runtime), d: 로 시작하는 속성들은 그냥 무시해(Ignore)."
    역할: 위에서 xmlns:d는 "디자인 미리보기용"이라고 했죠? 
    실제 프로그램이 돌아갈 때는 이 가짜 데이터가 필요 없으므로, 
    **"이건 개발할 때만 보는 거니까 실행할 땐 신경 끄고 에러 내지 마"**라고 컴퓨터에게 알려주는 것입니다.
    -->
    

    <Window.Resources>

        <Style x:Key="ResizeHandleStyle" TargetType="Rectangle">
            <Setter Property="Width" Value="10" />
            <Setter Property="Height" Value="10" />
            <Setter Property="Fill" Value="White" />
            <Setter Property="Stroke" Value="Black" />
            <Setter Property="Visibility" Value="Collapsed" />
        </Style>
        
        <ContextMenu x:Key="DrawingContextMenu" >
            <MenuItem Header="Draw Roi (관심 영역)" Click="Menu_DrawRoi_Click" />
            <Separator />
            <MenuItem Header="Draw Line (직선그리기)" Click="Menu_DrawLine_Click" />
            <MenuItem Header="Draw Circle (원 그리기)" Click="Menu_DrawCircle_Click" />
            <MenuItem Header="Draw Rectangle (사각형 그리기)" Click="Menu_DrawRect_Click" />
            <Separator />
            <MenuItem Header="Clear All (지우기)" Click="Menu_Clear_Click" />
            <Separator />
            <MenuItem Header="Fit to Screen (화면 맞춤)" Click="Menu_Fit_Click" />
            <Separator />
            <!-- [신규] 처리된 이미지 저장 메뉴 추가 -->
            <MenuItem Header="Save Processed Image (다른 이름으로 저장)" Command="{Binding SaveProcessedImageCommand}" />
        </ContextMenu>

        <DataTemplate DataType="{x:Type local:ThresholdParams}">
            <StackPanel>
                <TextBlock Text="Threshold Range" Margin="0,0,0,5" FontWeight="Bold"/>
                <TextBlock Text="Min Value" Margin="0,5,0,0"/>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="50"/>
                    </Grid.ColumnDefinitions>

                    <Slider Grid.Column="0" Maximum="255" Minimum="0" Value="{Binding ThresholdValue}" 
                            VerticalAlignment="Center" />
                    <TextBox Grid.Column="1" Text="{Binding ThresholdValue}" Margin="5,0,0,0"
                             TextAlignment="Center" />
                </Grid>

                <TextBlock Text="Max Value" Margin="0,5,0,0"/>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="50" />
                    </Grid.ColumnDefinitions>

                    <Slider Grid.Column="0" Minimum="0" Maximum="255" Value="{Binding ThresholdMax}" 
                            VerticalAlignment="Center" />
                    <TextBox Grid.Column="1" Text="{Binding ThresholdMax}" Margin="5,0,0,0"
                             TextAlignment="Center" />
                </Grid>
            </StackPanel>
        </DataTemplate>

        <DataTemplate DataType="{x:Type local:OtsuParams}">
            <StackPanel>
                <TextBlock Text="Otsu Threshold Settings" Margin="0,0,0,5" FontWeight="Bold"/>
                <TextBlock Text="Threshold Type" Margin="0,5,0,0"/>
                <!-- ItemsSource를 파라미터 객체의 리스트 속성에 바인딩 -->
                <ComboBox ItemsSource="{Binding ThresholdTypesSource}" 
                          SelectedItem="{Binding SelectedType}"
                          Margin="0,2,0,0" Height="25"/>
                <TextBlock Text="* 자동으로 최적의 임계값을 찾습니다." 
                           Foreground="Gray" FontSize="11" Margin="0,5,0,0"/>
            </StackPanel>
        </DataTemplate>

        <DataTemplate DataType="{x:Type local:AdaptiveThresholdParams}">
            <StackPanel>
                <TextBlock Text="Adaptive Threshold Settings" Margin="0,0,0,5" FontWeight="Bold"/>

                <TextBlock Text="Adaptive Method" Margin="0,5,0,0"/>
                <ComboBox ItemsSource="{Binding AdaptiveMethodSource}" 
                          SelectedItem="{Binding AdaptiveMethod}"
                          Margin="0,2,0,0" Height="25"/>

                <TextBlock Text="Threshold Type" Margin="0,5,0,0"/>
                <ComboBox ItemsSource="{Binding ThresholdTypesSource}" 
                          SelectedItem="{Binding ThresholdType}"
                          Margin="0,2,0,0" Height="25"/>
                
                <TextBlock Text="Adaptive Threshold Settings" Margin="0,0,0,5" FontWeight="Bold"/>
                <TextBlock Text="Block Size (홀수만 가능)" Margin="0,5,0,0"/>

                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="50"/>
                    </Grid.ColumnDefinitions>

                    <Slider Grid.Column="0" Maximum="99" Minimum="3" SmallChange="2" LargeChange="2" 
                            TickFrequency="2" IsSnapToTickEnabled="True"
                            Value="{Binding BlockSize}" VerticalAlignment="Center"/>
                    <TextBox Grid.Column="1" Text="{Binding BlockSize}" Margin="5,0,0,0"
                             TextAlignment="Center"/>
                </Grid>

                <TextBlock Text="Contant (C)" Margin="0,5,0,0" />
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="50"/>
                    </Grid.ColumnDefinitions>

                    <Slider Grid.Column="0" Minimum="-20" Maximum="50" Value="{Binding ConstantC}"
                            VerticalAlignment="Center"/>
                    <TextBox Grid.Column="1" Text="{Binding ConstantC}" Margin="5,0,0,0"
                             TextAlignment="Center"/>
                </Grid>
            </StackPanel>
        </DataTemplate>

        <!-- Histogram 템플릿 -->
        <DataTemplate DataType="{x:Type local:HistogramParams}">
            <StackPanel>
                <TextBlock Text="Histogram Settings" Margin="0,0,0,5" FontWeight="Bold"/>

                <TextBlock Text="Channel (Color)" Margin="0,5,0,0"/>
                <ComboBox ItemsSource="{Binding ChannelSource}" SelectedItem="{Binding Channel}" Margin="0,2,0,0" Height="25"/>

                <TextBlock Text="Mask Mode" Margin="0,5,0,0"/>
                <ComboBox ItemsSource="{Binding MaskModeSource}" SelectedItem="{Binding MaskMode}" Margin="0,2,0,0" Height="25"/>

                <TextBlock Text="Hist Size (Bins)" Margin="0,5,0,0"/>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="50"/>
                    </Grid.ColumnDefinitions>
                    <Slider Grid.Column="0" Minimum="1" Maximum="256" Value="{Binding HistSize}" VerticalAlignment="Center" />
                    <TextBox Grid.Column="1" Text="{Binding HistSize}" Margin="5,0,0,0" TextAlignment="Center" />
                </Grid>

                <TextBlock Text="Range (Min - Max)" Margin="0,5,0,0"/>
                <Grid Margin="0,2,0,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="10"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <TextBox Grid.Column="0" Text="{Binding RangeMin}" TextAlignment="Center"/>
                    <TextBlock Grid.Column="1" Text="~" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                    <TextBox Grid.Column="2" Text="{Binding RangeMax}" TextAlignment="Center"/>
                </Grid>

                <TextBlock Text="* Apply 버튼을 누르면 팝업창이 뜹니다." Foreground="Blue" FontSize="11" Margin="0,10,0,0" TextWrapping="Wrap"/>
            </StackPanel>
        </DataTemplate>

        <!-- Normalize 템플릿 -->
        <DataTemplate DataType="{x:Type local:NormalizeParams}">
            <StackPanel>
                <TextBlock Text="Normalize Settings" Margin="0,0,0,5" FontWeight="Bold"/>

                <TextBlock Text="Normalization Type" Margin="0,5,0,0"/>
                <ComboBox ItemsSource="{Binding NormTypeSource}" SelectedItem="{Binding NormType}" Margin="0,2,0,0" Height="25"/>

                <TextBlock Text="Alpha (Min / Norm Value)" Margin="0,5,0,0"/>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="50"/>
                    </Grid.ColumnDefinitions>
                    <!-- Alpha는 범용적인 값이므로 Slider 범위를 넉넉하게 잡거나 TextBox 위주로 사용 -->
                    <Slider Grid.Column="0" Minimum="0" Maximum="255" Value="{Binding Alpha}" VerticalAlignment="Center" />
                    <TextBox Grid.Column="1" Text="{Binding Alpha}" Margin="5,0,0,0" TextAlignment="Center" />
                </Grid>

                <TextBlock Text="Beta (Max Value for MinMax)" Margin="0,5,0,0"/>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="50"/>
                    </Grid.ColumnDefinitions>
                    <Slider Grid.Column="0" Minimum="0" Maximum="255" Value="{Binding Beta}" VerticalAlignment="Center" />
                    <TextBox Grid.Column="1" Text="{Binding Beta}" Margin="5,0,0,0" TextAlignment="Center" />
                </Grid>

                <TextBlock Text="* Alpha: MinMax 모드에서 최소값, 그 외엔 기준값" Foreground="Gray" FontSize="11" Margin="0,5,0,0" TextWrapping="Wrap"/>
                <TextBlock Text="* Beta: MinMax 모드에서 최대값 (그 외엔 무시)" Foreground="Gray" FontSize="11" Margin="0,2,0,0" TextWrapping="Wrap"/>
                <TextBlock Text="* 적용 후 히스토그램 팝업이 뜹니다." Foreground="Blue" FontSize="11" Margin="0,5,0,0" TextWrapping="Wrap"/>

            </StackPanel>
        </DataTemplate>

        <DataTemplate DataType="{x:Type local:ClaheParams}">
            <StackPanel>
                <TextBlock Text="CLAHE Settings" Margin="0,0,0,5" FontWeight="Bold"/>

                <TextBlock Text="Clip Limit (대비 제한)" Margin="0,5,0,0"/>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="50"/>
                    </Grid.ColumnDefinitions>
                    <Slider Grid.Column="0" Minimum="1" Maximum="100" Value="{Binding ClipLimit}" VerticalAlignment="Center" />
                    <TextBox Grid.Column="1" Text="{Binding ClipLimit}" Margin="5,0,0,0" TextAlignment="Center" />
                </Grid>

                <TextBlock Text="Tile Grid Size (격자 크기)" Margin="0,5,0,0"/>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="50"/>
                    </Grid.ColumnDefinitions>
                    <Slider Grid.Column="0" Minimum="1" Maximum="32" Value="{Binding TileGridSize}" VerticalAlignment="Center" IsSnapToTickEnabled="True" TickFrequency="1"/>
                    <TextBox Grid.Column="1" Text="{Binding TileGridSize}" Margin="5,0,0,0" TextAlignment="Center" />
                </Grid>

                <TextBlock Text="* Clip Limit: 값이 클수록 대비가 강해지지만 노이즈도 증가합니다." Foreground="Gray" FontSize="11" Margin="0,5,0,0" TextWrapping="Wrap"/>
                <TextBlock Text="* Tile Size: 이미지를 나누는 격자 크기입니다 (예: 8 -> 8x8)." Foreground="Gray" FontSize="11" Margin="0,2,0,0" TextWrapping="Wrap"/>
                <TextBlock Text="* 적용 후 히스토그램 팝업이 뜹니다." Foreground="Blue" FontSize="11" Margin="0,5,0,0" TextWrapping="Wrap"/>
            </StackPanel>
        </DataTemplate>


        <!-- [신규] Geometric Params 템플릿 (통합) -->
        <DataTemplate DataType="{x:Type local:GeometricParams}">
            <StackPanel>
                <TextBlock Text="Geometric Transformation" Margin="0,0,0,5" FontWeight="Bold"/>

                <TextBlock Text="Interpolation (보간법)" Margin="0,5,0,0"/>
                <ComboBox ItemsSource="{Binding InterpolationSource}" SelectedItem="{Binding Interpolation}" Margin="0,2,0,0" Height="25"/>

                <TextBlock Text="Move X (Translation)" Margin="0,5,0,0"/>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="50"/>
                    </Grid.ColumnDefinitions>
                    <Slider Grid.Column="0" Minimum="-500" Maximum="500" Value="{Binding MoveX}" VerticalAlignment="Center" />
                    <TextBox Grid.Column="1" Text="{Binding MoveX}" Margin="5,0,0,0" TextAlignment="Center" />
                </Grid>

                <TextBlock Text="Move Y (Translation)" Margin="0,5,0,0"/>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="50"/>
                    </Grid.ColumnDefinitions>
                    <Slider Grid.Column="0" Minimum="-500" Maximum="500" Value="{Binding MoveY}" VerticalAlignment="Center" />
                    <TextBox Grid.Column="1" Text="{Binding MoveY}" Margin="5,0,0,0" TextAlignment="Center" />
                </Grid>

                <TextBlock Text="Rotation Angle (Degree)" Margin="0,5,0,0"/>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="50"/>
                    </Grid.ColumnDefinitions>
                    <Slider Grid.Column="0" Minimum="-180" Maximum="180" Value="{Binding Angle}" VerticalAlignment="Center" />
                    <TextBox Grid.Column="1" Text="{Binding Angle}" Margin="5,0,0,0" TextAlignment="Center" />
                </Grid>

                <TextBlock Text="Scale Factor (Ratio)" Margin="0,5,0,0"/>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="50"/>
                    </Grid.ColumnDefinitions>
                    <!-- 축소(0.1) ~ 확대(3.0) -->
                    <Slider Grid.Column="0" Minimum="0.1" Maximum="3.0" Value="{Binding Scale}" VerticalAlignment="Center" TickFrequency="0.1" IsSnapToTickEnabled="True"/>
                    <TextBox Grid.Column="1" Text="{Binding Scale}" Margin="5,0,0,0" TextAlignment="Center" />
                </Grid>

                <TextBlock Text="* 중심축(Center) 기준으로 회전/확대가 적용됩니다." Foreground="Gray" FontSize="11" Margin="0,5,0,0" TextWrapping="Wrap"/>
            </StackPanel>
        </DataTemplate>

        <!-- [신규] Affine Params 템플릿 -->
        <DataTemplate DataType="{x:Type local:AffineParams}">
            <StackPanel>
                <TextBlock Text="Affine Transformation" Margin="0,0,0,5" FontWeight="Bold"/>

                <TextBlock Text="Selected Points (3 Points)" Margin="0,5,0,0"/>
                <TextBox Text="{Binding PointInfo, Mode=OneWay}" IsReadOnly="True" Background="#EEEEEE" Padding="3" Margin="0,2,0,0"/>

                <TextBlock Text="* 이미지 위를 클릭하여 3개의 점을 순서대로 지정하세요." Foreground="Gray" FontSize="11" Margin="0,2,0,0" TextWrapping="Wrap"/>
                <TextBlock Text="(빨강 -> 초록 -> 파랑)" Foreground="Gray" FontSize="11" Margin="0,0,0,0" TextWrapping="Wrap"/>

                <TextBlock Text="Interpolation (보간법)" Margin="0,10,0,0"/>
                <ComboBox ItemsSource="{Binding InterpolationSource}" SelectedItem="{Binding Interpolation}" Margin="0,2,0,0" Height="25"/>
            </StackPanel>
        </DataTemplate>


        <!-- [신규] Perspective Params 템플릿 -->
        <DataTemplate DataType="{x:Type local:PerspectiveParams}">
            <StackPanel>
                <TextBlock Text="Perspective Transformation" Margin="0,0,0,5" FontWeight="Bold"/>

                <TextBlock Text="Selected Points (4 Points)" Margin="0,5,0,0"/>
                <TextBox Text="{Binding PointInfo, Mode=OneWay}" IsReadOnly="True" Background="#EEEEEE" Padding="3" Margin="0,2,0,0" Height="40" TextWrapping="Wrap"/>

                <TextBlock Text="* 이미지 위를 클릭하여 4개의 점을 순서대로 지정하세요." Foreground="Gray" FontSize="11" Margin="0,2,0,0" TextWrapping="Wrap"/>
                <TextBlock Text="(좌상(R) -> 우상(G) -> 우하(B) -> 좌하(Y))" Foreground="Gray" FontSize="11" Margin="0,0,0,0" TextWrapping="Wrap"/>

                <TextBlock Text="Interpolation (보간법)" Margin="0,10,0,0"/>
                <ComboBox ItemsSource="{Binding InterpolationSource}" SelectedItem="{Binding Interpolation}" Margin="0,2,0,0" Height="25"/>
            </StackPanel>
        </DataTemplate>

        <DataTemplate DataType="{x:Type local:AlgorithmParameters}">
            <TextBlock Text="설정 가능한 속성이 없습니다."
                Foreground="Gray"
                FontStyle="Italic" />
        </DataTemplate>

    </Window.Resources>

    <Window.DataContext>
        <local:MainViewModel/>
    </Window.DataContext>
    
    <Grid Background="#F0F0F0">
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <Grid Grid.Row="0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="auto"/>
                <ColumnDefinition Width="320"/>
            </Grid.ColumnDefinitions>

            <Grid Grid.Column="0" Margin="10">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,5" Panel.ZIndex="1">
                    <CheckBox Content="Original Image Show"
                              IsChecked="{Binding ShowOriginal}"
                              FontWeight="Bold" FontSize="14" VerticalAlignment="Center" />
                </StackPanel>

                <!--<Image Grid.Row="1" x:Name="ImgView" Source="{Binding DisplayImage}" 
                       Stretch="None"/>-->

                <Border Grid.Row="1" x:Name="ZoomBorder"
                        BorderBrush="#333" BorderThickness="1" Background="#333333"
                        ClipToBounds="True"
                        MouseRightButtonDown="ZoomBorder_MouseRightButtonDown"
                        MouseWheel="ZoomBorder_MouseWheel"
                        MouseDown="ZoomBorder_MouseDown"
                        MouseUp="ZoomBorder_MouseUp"
                        MouseMove="ZoomBorder_MouseMove"
                        SizeChanged="ZoomBorder_SizeChanged"
                        Loaded="ZoomBorder_Loaded"
                        >

                    <!--Image 에서 Stretch 속성:
                    Stretch 속성은 **"원본 이미지를 화면에 표시할 영역(컨트롤 크기)에 맞춰 어떻게 늘리거나 줄일지"**를 결정하는 매우 중요한 속성
                    쉽게 말해, **"액자(Image 컨트롤) 크기와 사진(Source) 크기가 다를 때 어떻게 끼워 넣을 것인가?"**를 정하는 규칙으로 총 4가지 모드를 가짐.
                    
                    Strech = "None" : 이미지를 전혀 늘리거나 줄이지 않고 원본 크기 그대로 표시.
                    줌/이동 기능을 구현할때 설정하며, 억지로 크기를 맞추면 좌표계산이 복잡. (픽셀 단위의 정밀한 검사가 필요할 때 사용)
                    
                    Strech = "Fill" : 이미지를 억지로 늘려서 액자에 꽉 차게 만듭니다.
                    가로/세로 비율(종횡비)을 무시.
                    이미지가 홀쭉해지거나 뚱뚱해지는 등 왜곡(찌그러짐)이 발생.
                    여백은 절대 생기지 않습니다.
                    
                    Stretch="Uniform" : 이미지의 가로/세로 비율을 유지하면서, 액자 안에 이미지가 전부 다 들어오도록 크기를 조절
                    이미지가 잘리지 않고 온전하게 다 보입니다.
                    대신 액자와 이미지의 비율이 안 맞으면 **빈 공간(여백)**이 생깁니다.
                    비전 검사 프로그램에서 가장 많이 씁니다. 이미지 전체를 왜곡 없이 한눈에 봐야 할 때 적합.
                    
                    Stretch="UniformToFill" : 이미지의 가로/세로 비율을 유지하면서, 액자에 빈 공간이 없도록 꽉 채움.
                    액자를 꽉 채우기 위해 이미지를 확대하다 보니, 이미지의 일부가 잘려 나감.
                    왜곡은 없지만, 전체를 볼 수 없음.
                    썸네일, 프로필 사진 등 내용은 좀 잘려도 화면을 예쁘게 꽉 채우는 게 중요할 때 사용.
                    -->

                    <!--RenderOptions.BitmapScalingMode="NearestNeighbor" : 
                    이미지를 확대하거나 축소할 때 픽셀을 어떻게 처리할지(렌더링 방식)를 결정하는 아주 중요한 설정
                    비전 검사 프로그램이나 픽셀 단위의 정밀한 작업에서 필수적으로 사용하는 옵션.
                    
                    WPF에게 "이미지 크기가 변할 때(특히 확대할 때) 픽셀을 어떻게 채워 넣을래?"라고 물어보는 속성으로,
                    NearestNeighbor (최근접 이웃 보간법):"가장 가까이 있는 픽셀 색상을 그대로 가져와서 채워라"라는 뜻.
                    
                    사용하는 이유: WPF의 기본 설정(HighQuality 또는 Linear)은 이미지를 확대하면 계단 현상을 없애기 위해 픽셀 사이를 부드럽게 뭉개버립니다(Blur 처리). 
                    사진 감상용으로는 좋지만, 정밀 검사용으로는 치명적입니다.
                    
                    기본 모드(HighQulity/Linear): 확대하면 이미지가 뿌옇게 보이며, 이것이 실제 데이터 인지, 화면이 뭉게진것인지 구분할수 없음.
                    작은 결함(Defect)이나 엣지(Edge)가 흐릴해져서 안보일수 있음.
                    
                    NearestNeighbor 모드: 확대하면 픽셀 하나하나가 네모난 격자(모자이크) 형태로 뚜렷하게 보임.
                    원본 데이터 그대로 확인 가능하며, 엣지 검출, 불량 픽셀 확인 등 분석 작업에 최적화.
                    NearestNeighbor는 복잡한 수학적 계산(주변 색상 섞기)을 하지 않고, 그냥 옆에 있는 색을 복사해오기 때문에 연산 속도가 가장 빠릅니다.
                    -->

                    <Canvas x:Name="ImgCanvas">
                        <Image x:Name="ImgView" Source="{Binding DisplayImage}" Stretch="None"
                           RenderOptions.BitmapScalingMode="NearestNeighbor"
                           HorizontalAlignment="Left"
                           VerticalAlignment="Top"
                           SizeChanged="ImgView_SizeChanged">
                            <Image.RenderTransform>
                                <TransformGroup>
                                    <ScaleTransform x:Name="imgScale"/>
                                    <TranslateTransform x:Name="imgTranslate"/>
                                </TransformGroup>
                            </Image.RenderTransform>
                        </Image>




                        <!--**"이미지 위에 그림(도형, ROI 박스)을 그리기 위한 투명한 층(Layer)"**을 만드는 핵심
                        단순히 Canvas를 올린 것이 아니라, 이미지의 확대/축소/이동(Zoom/Pan)과 완벽하게 동기화되도록 설계된 아주 똑똑한 코드.
                        
                        1. 좌표계 동기화 ("이미지가 커지면 그림도 커져야 한다")
                        이미지(ImgView)가 변할 때, 캔버스(OverlayCanvas)도 똑같이 변해라고 명령
                        RenderTransform 바인딩: 이것 덕분에 복잡한 수학 계산 없이, 
                        이미지가 2배 커지면 ROI 박스도 자동으로 2배 커지고, 이미지가 오른쪽으로 이동하면 박스도 오른쪽으로 따라갑니다. 
                        마치 이미지 위에 그림이 인쇄된 것처럼 찰싹 붙어 다니게 만드는 마법입니다.
                        
                        2. 이벤트 투과 ("마우스 클릭은 통과시켜라"): IsHitTestVisible="False"
                        이 캔버스는 마우스 클릭을 감지하지 말고 무시. 
                        이 Canvas는 이미지 바로 위에 덮여 있습니다. 만약 이 속성이 True(기본값)라면, 
                        사용자가 이미지를 드래그하려고 클릭했을 때 캔버스가 클릭을 가로채서 뒤에 있는 이미지 이동(Pan) 기능이 먹통이 됩니다.
                        False로 설정함으로써, 사용자가 빈 곳을 클릭하면 클릭이 캔버스를 뚫고 지나가 뒤에 있는 ZoomBorder에 전달되어 줌/이동 기능이 정상 작동하게 합니다.
                        -->
                        <Canvas x:Name="OverlayCanvas"
                                Width="{Binding Source.Width, ElementName=ImgView}"
                                Height="{Binding Source.Height, ElementName=ImgView}"
                                RenderTransform="{Binding RenderTransform, ElementName=ImgView}"
                                IsHitTestVisible="False" />

                        <!--사용자가 드래그해서 그릴 **"선택 영역(ROI)"**을 미리 정의
                        Visibility="Collapsed": 처음에는 숨겨뒀다가, 사용자가 "ROI 그리기"를 시작하면 C# 코드에서 보이게(Visible) 만듭니다.
                        ContextMenu: ROI 사각형을 우클릭했을 때만 뜨는 전용 메뉴(자르기, 저장하기)를 XAML에 심어두었습니다. 
                        이렇게 하면 C# 코드에서 "마우스가 사각형 안에 있는지" 복잡하게 계산해서 메뉴를 띄우는 수고를 덜 수 있습니다.
                        -->
                        <Rectangle x:Name="RoiRect" Stroke="Red" StrokeThickness="2"
                                   Fill="#33FF0000" Visibility="Collapsed"
                                   >
                            <Rectangle.ContextMenu>
                                <ContextMenu>
                                    <MenuItem Header="Crop Image (잘라내기)" Click="MenuItem_Crop_Click" />
                                    <MenuItem Header="Save ROI (저장하기)" Click="MenuItem_Save_Click" />
                                </ContextMenu>
                            </Rectangle.ContextMenu>
                        </Rectangle>

                        <Rectangle x:Name="Handle_TL" Style="{StaticResource ResizeHandleStyle}"
                                   Cursor="SizeNWSE" MouseLeftButtonDown="ResizeHandle_MouseDown"/>
                        <Rectangle x:Name="Handle_TR" Style="{StaticResource ResizeHandleStyle}"
                                   Cursor="SizeNESW" MouseLeftButtonDown="ResizeHandle_MouseDown"/>
                        <Rectangle x:Name="Handle_BL" Style="{StaticResource ResizeHandleStyle}"
                                   Cursor="SizeNESW" MouseLeftButtonDown="ResizeHandle_MouseDown"/>
                        <Rectangle x:Name="Handle_BR" Style="{StaticResource ResizeHandleStyle}"
                                   Cursor="SizeNWSE" MouseLeftButtonDown="ResizeHandle_MouseDown"/>

                        <Rectangle x:Name="Handle_Top"    Style="{StaticResource ResizeHandleStyle}" 
                                   Cursor="SizeNS" MouseLeftButtonDown="ResizeHandle_MouseDown"/>
                        <Rectangle x:Name="Handle_Bottom" Style="{StaticResource ResizeHandleStyle}" 
                                   Cursor="SizeNS" MouseLeftButtonDown="ResizeHandle_MouseDown"/>
                        <Rectangle x:Name="Handle_Left"   Style="{StaticResource ResizeHandleStyle}" 
                                   Cursor="SizeWE" MouseLeftButtonDown="ResizeHandle_MouseDown"/>
                        <Rectangle x:Name="Handle_Right"  Style="{StaticResource ResizeHandleStyle}" 
                                   Cursor="SizeWE" MouseLeftButtonDown="ResizeHandle_MouseDown"/>



                    </Canvas>
                </Border>
            </Grid>

            <GridSplitter Grid.Column="1" Width="5"
              HorizontalAlignment="Center"
              VerticalAlignment="Stretch"
              Background="#FFBBBBBB"
              ShowsPreview="True"               
              ResizeBehavior="PreviousAndNext"
              />

            <Grid Grid.Column="2" Margin="0,10,10,10">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="2*"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <GroupBox Header="이미지 선택 버튼" Grid.Row="0" Padding="5" Margin="5,0,0,0">
                    <Button Content="이미지 파일 열기" Command="{Binding LoadImageCommand}" Height="35" Margin="2"/>
                </GroupBox>

                <GroupBox Header="이미지 전처리 알고리즘 선택" Grid.Row="1" Margin="5,10,0,0" Padding="5">
                    <ListBox ItemsSource="{Binding AlgorithmList}" 
                             SelectedItem="{Binding SelectedAlgorithm}"/>
                </GroupBox>

                <GridSplitter Grid.Row="2" Height="5"
                              HorizontalAlignment="Stretch"
                              VerticalAlignment="Center"
                              Background="#FFBBBBBB"
                              ShowsPreview="True"
                              ResizeBehavior="PreviousAndNext" />

                <GroupBox Header="이미지 전처리 및 검출 알고리즘 속성" Grid.Row="3" Margin="5,10,0,0" Padding="10" BorderBrush="#104E8B">
                    <ScrollViewer VerticalScrollBarVisibility="Auto">
                        <ContentControl Content="{Binding CurrentParameters}"/>
                    </ScrollViewer>
                </GroupBox>

                <Button Grid.Row="4" Content="적용 (Apply)" Command="{Binding ApplyAlgorithmCommand}" 
                        Height="45" Margin="5,10,0,0" FontWeight="Bold" Background="#104E8B" Foreground="White"/>
            </Grid>

        </Grid>


        
        <StatusBar Grid.Row="1" Background="White" BorderBrush="Gray" BorderThickness="0,1,0,0">
            <StatusBarItem Content="{Binding AnalysisResult}" FontWeight="Bold" Foreground="Blue" />

            <StatusBarItem HorizontalAlignment="Right">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="{Binding MouseCoordinationInfo}" Margin="0,0,20,0" 
                               VerticalAlignment="Center" FontWeight="SemiBold" />
                </StackPanel>
            </StatusBarItem>
        </StatusBar>
        
        
    </Grid>
</Window>
